async function initApp() {
        const loader = document.getElementById('loader');
        try {
            loader.innerText = "正在連線 LINE...";
            await liff.init({ liffId: liffId });
            
            if (!liff.isLoggedIn()) {
                liff.login();
            } else {
                loader.innerText = "正在抓取雲端資料...";
                const profile = await liff.getProfile();
                fetchUserData(profile.displayName);
            }
        } catch (e) {
            loader.innerText = "LINE 初始化失敗: " + e;
        }
    }

    async function fetchUserData(displayName) {
        try {
            const res = await fetch(apiUrl);
            const data = await res.json();
            
            // 隱藏載入畫面
            document.getElementById('loader').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            document.getElementById('welcome-title').innerText = "你好，" + displayName;

            // 比對姓名 (去掉空白)
            const myRecords = data.filter(r => String(r.姓名).trim() === displayName.trim());
            const listDiv = document.getElementById('record-list');
            
            if (myRecords.length > 0) {
                listDiv.innerHTML = myRecords.map(r => `
                    <div class="data-row">
                        <div>
                            <div class="item-name">${r.項目 || '無項目'}</div>
                            <div class="item-info">金額：$${r.金額 || 0}</div>
                        </div>
                        <div class="status ${r.狀態 === '未繳' ? 'unpaid' : 'paid'}">${r.狀態 || '未知'}</div>
                    </div>
                `).join('');
            } else {
                listDiv.innerHTML = `<p style='color:#999;'>查無「${displayName}」的資料。<br>請確認試算表中姓名是否完全一致。</p>`;
            }
        } catch (e) {
            document.getElementById('loader').innerText = "連線 Google 失敗，請確認腳本已設為『所有人』。";
        }
    }
